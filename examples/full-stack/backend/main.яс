из "lib/хранилище.яс" подключить следующий_id, все_записи, найти_по_id
из "lib/хранилище.яс" подключить сохранить, удалить_по_id, обновить_поле
из "lib/хранилище.яс" подключить отфильтровать, подсчитать

экспорт функция здоровье() -> Словарь[Строка, Строка]:
    вернуть {"статус": "ok", "сервис": "kanban-api", "версия": "1.0"}

экспорт функция создать_задачу(название: Строка, описание: Строка, приоритет: Строка) -> Словарь[Строка, Строка]:
    если название == "":
        вернуть {"ок": "0", "ошибка": "Название задачи обязательно"}
    если приоритет != "низкий" и приоритет != "средний" и приоритет != "высокий":
        вернуть {"ок": "0", "ошибка": "Приоритет: низкий, средний или высокий"}
    пусть id: Строка = следующий_id()
    пусть задача: Словарь[Строка, Строка] = {
        "id": id,
        "название": название,
        "описание": описание,
        "статус": "новая",
        "приоритет": приоритет
    }
    сохранить(задача)
    вернуть {"ок": "1", "id": id}

экспорт функция все_задачи() -> Список[Словарь[Строка, Строка]]:
    вернуть все_записи()

экспорт функция задача_по_id(id: Строка) -> Словарь[Строка, Строка]:
    вернуть найти_по_id(id)

экспорт функция задачи_по_статусу(статус: Строка) -> Список[Словарь[Строка, Строка]]:
    вернуть отфильтровать("статус", статус)

экспорт функция сменить_статус(id: Строка, новый_статус: Строка) -> Словарь[Строка, Строка]:
    если новый_статус != "новая" и новый_статус != "в_работе" и новый_статус != "готово":
        вернуть {"ок": "0", "ошибка": "Статус: новая, в_работе или готово"}
    пусть найдена: Лог = обновить_поле(id, "статус", новый_статус)
    если не найдена:
        вернуть {"ок": "0", "ошибка": "Задача не найдена"}
    вернуть {"ок": "1", "id": id, "статус": новый_статус}

экспорт функция обновить_задачу(id: Строка, название: Строка, описание: Строка, приоритет: Строка) -> Словарь[Строка, Строка]:
    если название == "":
        вернуть {"ок": "0", "ошибка": "Название задачи обязательно"}
    если приоритет != "низкий" и приоритет != "средний" и приоритет != "высокий":
        вернуть {"ок": "0", "ошибка": "Приоритет: низкий, средний или высокий"}
    пусть задача: Словарь[Строка, Строка] = найти_по_id(id)
    если содержит(задача, "ошибка"):
        вернуть {"ок": "0", "ошибка": "Задача не найдена"}
    обновить_поле(id, "название", название)
    обновить_поле(id, "описание", описание)
    обновить_поле(id, "приоритет", приоритет)
    вернуть {"ок": "1", "id": id}

экспорт функция удалить_задачу(id: Строка) -> Словарь[Строка, Строка]:
    пусть удалена: Лог = удалить_по_id(id)
    если не удалена:
        вернуть {"ок": "0", "ошибка": "Задача не найдена"}
    вернуть {"ок": "1", "id": id}

экспорт функция статистика() -> Словарь[Строка, Строка]:
    пусть новые: Цел = подсчитать("статус", "новая")
    пусть в_работе: Цел = подсчитать("статус", "в_работе")
    пусть готово: Цел = подсчитать("статус", "готово")
    пусть всего: Цел = новые + в_работе + готово
    вернуть {
        "всего": строка(всего),
        "новые": строка(новые),
        "в_работе": строка(в_работе),
        "готово": строка(готово)
    }

функция main() -> Пусто:
    создать_задачу("Настроить CI/CD", "Автоматизация сборки и деплоя", "высокий")
    создать_задачу("Написать тесты", "Unit-тесты для API модулей", "средний")
    создать_задачу("Обновить документацию", "Актуализировать README", "низкий")
    сменить_статус("2", "в_работе")
    печать("Kanban API запущен")
    печать("Статистика:", статистика())
    вернуть пусто
