# Анализ зрелости YASN относительно top-3 языков

## 1. Источники и контекст (актуально на 2026-02-10)

- **TIOBE (февраль 2026)**: топ-3 — Python, C, C++.
  Источник: <https://www.tiobe.com/tiobe-index/>
- **GitHub Octoverse 2025**: TypeScript #1, Python #2, JavaScript #3.
  Источник: <https://github.blog/news-insights/octoverse/octoverse-2025-top-programming-languages/>
- **RedMonk (январь 2025)**: JavaScript #1, Python #2, Java #3.
  Источник: <https://redmonk.com/sogrady/2025/06/18/language-rankings-1-25/>

Итого по пересечению экосистем:

- Python стабильно в топе всех индексов.
- TypeScript/JavaScript доминируют в modern web/full-stack.
- Языки-лидеры объединяют: сильные инструменты, развитый stdlib, тестирование, зрелую модульность.

## 2. Базовые критерии зрелости (взяты по реальному поведению лидеров)

1. Статическая/контрольная проверка кода до рантайма.
2. Богатая стандартная библиотека для прикладных задач (файлы, JSON, HTTP).
3. Встроенный и удобный тестовый контур.
4. Повторяемый dependency workflow.
5. Понятный и полноценный CLI + документация.

## 3. Что было узким местом в YASN до доработки

- отсутствовал полноценный нативный type checker;
- не хватало прикладного stdlib (файлы/JSON/HTTP);
- не было нативного `yasn test`;
- документация и учебник были неполностью синхронизированы с реализацией.

## 4. Что реализовано в этой итерации

### 4.1 Нативный type checker

Добавлен `native/yasn-native/Core/TypeChecker.cs` и включён в pipeline:

- проверка совместимости типов присваиваний/возвратов;
- проверка условий и индексирования;
- проверка сигнатур функций и `main`;
- проверка встроенных функций и их аргументов;
- поддержка `Список`, `Словарь`, union и nullable.

### 4.2 Расширенный stdlib рантайма

В `native/yasn-native/Runtime/VirtualMachine.cs` добавлены builtin-функции:

- файлы: `файл_читать`, `файл_записать`, `файл_существует`, `файл_удалить`;
- JSON: `json_разобрать`, `json_строка`;
- HTTP: `http_get`, `http_post`;
- утилиты: `время_мс`, `случайное_цел`;
- тесты/assert: `утверждать`, `утверждать_равно`, `провал`.

Также улучшено сравнение значений (deep equality для списков/словарей).

### 4.3 Нативный тестовый раннер

Добавлен `native/yasn-native/Runner/TestRunner.cs` и команда CLI:

```text
yasn test [path|file] [--pattern ...] [--fail-fast] [--verbose]
```

### 4.4 Учебные и референсные тесты

Добавлены тестовые сценарии:

- `tests/math_test.яс`
- `tests/async_test.яс`
- `tests/stdlib_test.яс`

### 4.5 Документация

Профессионально синхронизированы:

- `README.md`
- `docs/cli-reference.md`
- `docs/language-reference.md`
- `docs/language-tutorial.md`
- `docs/quickstart.md`
- `docs/architecture.md`
- `docs/native-toolchain.md`

### 4.6 Стабилизация компилятора и VM (итерация 2)

Проведён глубокий аудит всех модулей: Lexer, Parser, TypeChecker, Compiler, ModuleResolver, VirtualMachine.

**Критические баги (исправлено):**

- деление на ноль в VM бросало неперехваченное .NET-исключение; добавлена явная проверка;
- `RuntimeValueComparer` не сравнивал числовые типы (`1L` vs `1`); переписан с кросс-числовым хешированием;
- `AliasRewriter` не переписывал `AssignStmt.Name` при импорте; исправлено;
- `AnyType` в бинарных выражениях ошибочно возвращал `Строка` вместо `Любой`; добавлен early return;
- stack underflow молча возвращал null; заменено на исключение.

**Языковые фичи (добавлено):**

- `иначе если` (аналог `elif`) — цепочки условий без вложенности;
- bare `вернуть` — допускается в функциях `-> Пусто`;
- `дробное(x)` — преобразование строки/целого в дробное число;
- точечный доступ к полям словаря (`данные.имя`) — чтение и запись;
- `MemberExpr` корректно компилируется как `INDEX_GET`/`INDEX_SET`.

**Стабильность (добавлено):**

- лимит глубины вызовов: 1000 (защита от бесконечной рекурсии);
- очистка float-сравнений от вводящего в заблуждение `double.Epsilon`.

**IDE/extension:**

- подсветка синтаксиса: добавлен `дробное` в builtin-функции;
- автоотступы: поддержка `иначе если`.

## 5. Что ещё осталось до «уровня лидеров»

1. Пользовательские типы высокого уровня (классы/структуры).
2. Языковые исключения (`try/catch/finally`).
3. Полноценный пакетный registry и semver-резолвинг.
4. LSP/интерактивная диагностика в IDE.
5. Профилировщик/отладчик и продвинутый observability tooling.
6. Строковая интерполяция (`"Привет, {имя}!"`).
7. Проверка полноты возвращаемых значений (все пути функции).

## 6. Вывод

После двух итераций YASN закрывает критичные инженерные разрывы для практического backend/full-stack применения:

- строгая нативная проверка типов,
- прикладной stdlib,
- встроенный тестовый workflow,
- защитные механизмы рантайма (деление на ноль, рекурсия, stack overflow),
- `иначе если`, точечный доступ, `дробное()` и bare `вернуть`,
- выровненная документация и учебный контур.

Это переводит проект из состояния "рабочий самостоятельный язык" в состояние "стабильный язык с основными конструкциями, сопоставимыми с Python/JS".
