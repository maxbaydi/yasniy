# ЯСНЫЙ: учебник по языку

Этот файл — основное обучение по написанию программ на ЯСНЫЙ.

## 1. Первая программа

Создайте файл `hello.яс`:

```text
функция main() -> Пусто:
    печать("Привет, ЯСНЫЙ!")
    вернуть пусто
```

Запуск:

```powershell
yasn run hello.яс
```

## 2. Переменные и типы

```text
пусть n = 10
пусть pi: Дроб = 3.14
пусть имя: Строка = "Максим"
пусть ok: Лог = истина
пусть пустое: Пусто = пусто
```

Правила:

- `пусть` создает новую переменную
- Тип можно не указывать, он выводится из выражения
- Переприсваивание разрешено только совместимым типом

```text
n = 20      # OK
n = "x"    # ошибка типов
```

## 3. Функции

```text
функция сумма(a: Цел, b: Цел) -> Цел:
    вернуть a + b
```

```text
функция лог(msg: Строка) -> Пусто:
    печать(msg)
    вернуть пусто
```

Точка входа:

```text
функция main() -> Пусто:
    печать(сумма(2, 3))
    вернуть пусто
```

## 4. Условия

```text
пусть x: Цел = 7
если x > 10:
    печать("больше 10")
иначе:
    печать("10 или меньше")
```

## 5. Циклы

### 5.1 `пока`

```text
пусть i: Цел = 0
пока i < 5:
    печать(i)
    i = i + 1
```

### 5.2 `для` по диапазону

```text
для i в диапазон(0, 5):
    печать(i)
```

### 5.3 `для` по списку

```text
пусть arr: Список[Цел] = [10, 20, 30]
для x в arr:
    печать(x)
```

### 5.4 `прервать` и `продолжить`

```text
для i в диапазон(0, 10):
    если i == 2:
        продолжить
    если i == 6:
        прервать
    печать(i)
```

## 6. Коллекции и индексация

### 6.1 Списки

```text
пусть arr: Список[Цел] = [1, 2, 3]
печать(arr[0])
arr[1] = 99
печать(arr)
```

### 6.2 Словари

```text
пусть rates: Словарь[Строка, Цел] = { "usd": 100, "eur": 110 }
печать(rates["usd"])
rates["usd"] = 120
печать(rates)
```

### 6.3 Строки

```text
пусть s: Строка = "ЯСНЫЙ"
печать(s[0])
печать(длина(s))
```

## 7. Union и nullable типы

```text
пусть v: Цел | Строка = 10
печать(v)
v = "текст"
печать(v)
```

```text
пусть user: Строка? = пусто
если user == пусто:
    печать("пользователь не задан")
```

## 8. Модули

### 8.1 Экспорт в модуле

`examples/lib/математика.яс`:

```text
экспорт пусть версия: Строка = "1.0.0"

экспорт функция сумма(a: Цел, b: Цел) -> Цел:
    вернуть a + b

функция скрытая() -> Пусто:
    печать("не экспортируется")
    вернуть пусто
```

### 8.2 Импорт всего модуля

```text
подключить "lib/математика.яс"

функция main() -> Пусто:
    печать(сумма(2, 3))
    печать(версия)
    вернуть пусто
```

### 8.3 Импорт с namespace

```text
подключить "lib/математика.яс" как мат

функция main() -> Пусто:
    печать(мат.сумма(2, 3))
    печать(мат.версия)
    вернуть пусто
```

### 8.4 Выборочный импорт

```text
из "lib/математика.яс" подключить сумма
из "lib/математика.яс" подключить версия как v

функция main() -> Пусто:
    печать(сумма(4, 5), v)
    вернуть пусто
```

### 8.5 Конфигурация путей модулей

В корне проекта создайте `yasn.toml`:

```toml
[modules]
root = "examples"
paths = ["examples/lib"]
```

Теперь `подключить "lib/математика.яс"` работает независимо от текущей директории запуска, если файл найден по правилам резолвера.

## 9. Встроенные функции

- `печать(...)`
- `длина(x)`
- `диапазон(нач, конец)`
- `ввод()`
- `пауза(мс)`
- `запустить(имя_функции, ...args)`
- `готово(задача)`
- `ожидать(задача[, таймаут_мс])`
- `ожидать_все(список_задач[, таймаут_мс])`
- `отменить(задача)`

Пример:

```text
функция main() -> Пусто:
    пусть имя: Строка = ввод()
    печать("Привет,", имя)
    вернуть пусто
```

## 10. Асинхронность и параллельные задачи

```text
асинхронная функция тяжелая_цель(x: Цел) -> Цел:
    пауза(250)
    вернуть x * x

функция main() -> Пусто:
    пусть t1: Задача = тяжелая_цель(10)
    пусть t2: Задача = тяжелая_цель(20)

    пусть r1: Цел = ждать t1
    пусть r2: Цел = ждать t2
    печать("результаты:", r1, r2)
    вернуть пусто
```

Важно:

- `асинхронная функция ...` при вызове возвращает `Задача`;
- `ждать task` эквивалентно `ожидать(task)`;
- задачи выполняются в пуле потоков VM;
- каждая задача получает изолированный снимок глобальных переменных;
- для контроля таймаута используйте `ожидать(task, 500)` (в миллисекундах).

## 11. Практический пример: факториал

```text
функция факториал(n: Цел) -> Цел:
    если n < 0:
        печать("Ошибка: n < 0")
        вернуть 0
    пусть res: Цел = 1
    пусть i: Цел = 2
    пока i <= n:
        res = res * i
        i = i + 1
    вернуть res

функция main() -> Пусто:
    для x в диапазон(0, 6):
        печать(x, "=>", факториал(x))
    вернуть пусто
```

## 12. Частые ошибки

- Табы вместо пробелов в отступах
- Попытка использовать необъявленную переменную
- Импорт символа, который не экспортируется
- Несовместимое присваивание (`Цел <- Строка`)
- Неверная сигнатура `main`

## 13. Где читать дальше

- Формальная спецификация: `docs/language-reference.md`
- Команды компилятора: `docs/cli-reference.md`
- Архитектура и устройство VM: `docs/architecture.md`

## 14. Backend пример

Готовый backend лежит в `examples/`:

- backend: `examples/backend/main.яс`
- модули backend: `examples/backend/lib/*.яс`

Запуск сервера:

```powershell
yasn serve examples/backend/main.яс --port 8123
```
