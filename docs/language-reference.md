---
layout: default
title: Справочник языка ЯСНЫЙ
---

# Справочник языка ЯСНЫЙ

Документ описывает актуальное поведение нативной реализации языка (`native/yasn-native`).

## 1. Лексика

### 1.1 Ключевые слова

`функция`, `асинхронная`, `вернуть`, `если`, `иначе`, `пока`, `для`, `в`, `и`, `или`, `не`, `ждать`, `истина`, `ложь`, `пусто`, `пусть`, `подключить`, `из`, `как`, `экспорт`, `прервать`, `продолжить`

### 1.2 Идентификаторы

- начало: буква Unicode или `_`
- продолжение: буквы, цифры, `_`

### 1.3 Литералы

- целые: `10`
- дробные: `3.14`
- строки: `"текст"` (`\n`, `\t`, `\r`, `\"`, `\\`)
- логические: `истина`, `ложь`
- пустое значение: `пусто`
- список: `[1, 2, 3]`
- словарь: `{ "a": 1, "b": 2 }`

### 1.4 Комментарии

- однострочные: `# комментарий`

## 2. Блоки и отступы

- блок начинается после `:`
- отступы только пробелами
- TAB запрещён
- используется модель `INDENT/DEDENT` с отступами

## 3. Типы

### 3.1 Базовые типы

- `Цел`
- `Дроб`
- `Лог`
- `Строка`
- `Пусто`
- `Любой`
- `Задача`

### 3.2 Параметризованные типы

- `Список[Т]`
- `Словарь[К,З]`

### 3.3 Union и nullable

- union: `Цел | Строка`
- nullable: `Строка?` (эквивалент `Строка | Пусто`)

### 3.4 Типизация

Язык проверяется нативным `TypeChecker` до компиляции в байткод.

Ключевые правила:

- переменные должны быть объявлены до использования;
- присваивание проверяется на совместимость типов;
- условия `если`/`пока` требуют `Лог` (или `Любой`);
- `main` должна быть без параметров и с `-> Пусто`.

## 4. Операторы

Приоритет (сильнее -> слабее):

1. `не`, унарный `-`, `ждать`
2. `* / %`
3. `+ -`
4. `== != < <= > >=`
5. `и`
6. `или`

## 5. Выражения

Поддерживаются:

- идентификаторы: `x`
- вызовы: `f(1, 2)`
- ожидание задачи: `ждать task`
- индексация: `arr[i]`, `dict[key]`, `text[i]`
- точечный доступ к полям словаря: `dict.поле`
- namespace-доступ: `мат.сумма(2, 3)`

## 6. Операторы языка

### 6.1 Переменные

```text
пусть x = 10
пусть y: Дроб = 3.14
x = 20
```

### 6.2 Функции

```text
функция сумма(a: Цел, b: Цел) -> Цел:
    вернуть a + b
```

```text
асинхронная функция сумма_медленно(a: Цел, b: Цел) -> Цел:
    пауза(100)
    вернуть a + b
```

### 6.3 Условия

```text
если x > 0:
    печать("плюс")
иначе если x == 0:
    печать("ноль")
иначе:
    печать("минус")
```

`иначе если` позволяет выстраивать цепочки условий без вложенности (аналог `elif` в Python).

### 6.4 Циклы

```text
пока i < 10:
    i = i + 1
```

```text
для x в диапазон(0, 5):
    печать(x)
```

### 6.5 Возврат и управление циклом

```text
вернуть a + b
вернуть
```

`вернуть` без выражения допускается в функциях с типом `-> Пусто` (неявно возвращает `пусто`).

```text
прервать
продолжить
```

### 6.6 Индексное и точечное присваивание

```text
arr[2] = 99
словарь["k"] = 42
словарь.k = 42
```

Точечный доступ `словарь.поле` эквивалентен `словарь["поле"]` и работает как для чтения, так и для записи.

## 7. Модули

### 7.1 Формы импорта

Полный импорт в текущую область:

```text
подключить "lib/математика.яс"
```

Импорт в namespace:

```text
подключить "lib/математика.яс" как мат
печать(мат.сумма(2, 3))
```

Выборочный импорт:

```text
из "lib/математика.яс" подключить сумма как add
```

### 7.2 Экспорт

```text
экспорт пусть версия: Строка = "1.0"

экспорт функция сумма(a: Цел, b: Цел) -> Цел:
    вернуть a + b
```

Если в модуле нет `экспорт`, действует режим совместимости:
экспортируются верхнеуровневые `пусть`/`функция` (кроме `main`).

### 7.3 Разрешение путей

Резолвер проверяет пути в порядке:

1. относительно директории текущего файла;
2. `modules.root` из `yasn.toml`;
3. каждый путь из `modules.paths`;
4. `.yasn/deps` проекта.

## 8. Стандартная библиотека (builtin функции)

### 8.1 Базовые

- `печать(...)->Пусто`
- `длина(x)->Цел`
- `диапазон(нач: Цел, конец: Цел)->Список[Цел]`
- `ввод()->Строка`
- `пауза(мс: Цел)->Пусто`
- `строка(x)->Строка`
- `число(x)->Цел`
- `дробное(x)->Дроб`
- `добавить(список, элемент)->Пусто`
- `удалить(список, индекс)->Любой`
- `ключи(словарь)->Список[Любой]`
- `содержит(словарь, ключ)->Лог`

### 8.2 Асинхронность

- `запустить(имя_функции: Строка, ...args)->Задача`
- `готово(task: Задача)->Лог`
- `ожидать(task: Задача, таймаут_мс?: Цел)->Любой`
- `ожидать_все(tasks: Список[Задача], таймаут_мс?: Цел)->Список[Любой]`
- `отменить(task: Задача)->Лог`

### 8.3 Файлы

- `файл_читать(путь: Строка)->Строка`
- `файл_записать(путь: Строка, данные: Строка)->Пусто`
- `файл_существует(путь: Строка)->Лог`
- `файл_удалить(путь: Строка)->Пусто`

### 8.4 JSON

- `json_разобрать(строка_json: Строка)->Любой`
- `json_строка(значение: Любой)->Строка`

### 8.5 HTTP

- `http_get(url: Строка)->Словарь[Строка, Любой]`
- `http_post(url: Строка, body: Строка)->Словарь[Строка, Любой]`

HTTP-результат содержит ключи:

- `status` (`Цел`)
- `ok` (`Лог`)
- `body` (`Строка`)

### 8.6 Утилиты

- `время_мс()->Цел`
- `случайное_цел(мин: Цел, макс: Цел)->Цел`

### 8.7 Тестовые утверждения

- `утверждать(условие: Лог, сообщение?: Строка)->Пусто`
- `утверждать_равно(факт: Любой, ожидание: Любой, сообщение?: Строка)->Пусто`
- `провал(сообщение?: Строка)->Пусто`

## 9. Тестирование

CLI команда:

```powershell
yasn test
yasn test tests --pattern "*_test.яс"
```

Тест считается успешным, если файл завершается без исключений.

## 10. Конфиг `yasn.toml`

```toml
[app]
name = "calculator-yasn"
displayName = "Калькулятор"
description = "Тестовый калькулятор на языке Ясный"
version = "0.6.0"
publisher = "Max Bay"

[modules]
root = "examples"
paths = ["examples/lib"]

[dependencies]
json = "git+https://example.com/yasn-json.git#v1.0.0"
core = "path:../shared/core-lib"

[run]
backend = "backend/main.яс"
host = "127.0.0.1"
port = 8000
```

`version` в `yasn.toml` поддерживает число (`1`, `1.2`) или semver-строку (`"1.2.3"`).

## 11. Поведение запуска

При `run`/`exec`:

1. выполняется top-level код;
2. если есть `main`, она вызывается автоматически.

## 12. Защитные механизмы рантайма

- деление на ноль выбрасывает ошибку (не крэш);
- лимит глубины вызовов: 1000 (защита от бесконечной рекурсии);
- stack underflow выбрасывает внутреннюю ошибку VM;
- числовые ключи словарей корректно сравниваются между `Цел` и `Дроб`.

## 13. Ограничения текущей версии

- нет классов/структур пользователя;
- нет исключений `try/catch` как конструкции языка;
- нет generic-функций пользователя;
- нет встроенного пакетного registry (есть `git/path`-источники);
- VM-интерпретация (без JIT/AOT backend для native-кода).
